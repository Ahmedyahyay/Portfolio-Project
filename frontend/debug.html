<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Personal Nutrition Assistant</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        
        .debug-section {
            background: white;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #008080;
        }
        
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .warning { border-left-color: #ffc107; }
        
        pre {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #008080;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>üîç Debug Personal Nutrition Assistant</h1>
    
    <div class="debug-section">
        <h3>üåê Server Connectivity</h3>
        <div id="server-status">
            <div class="loading"></div> Testing servers...
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üì° API Endpoints</h3>
        <div id="api-status">
            <div class="loading"></div> Testing API endpoints...
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üîß JavaScript Loading</h3>
        <div id="js-status">
            <div class="loading"></div> Testing JavaScript files...
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üìä Performance</h3>
        <div id="performance-status">
            <div class="loading"></div> Running performance tests...
        </div>
    </div>

    <script>
        console.log('üöÄ Debug script started');
        
        async function debugServers() {
            const serverStatus = document.getElementById('server-status');
            
            try {
                // Test frontend server
                const frontendStart = performance.now();
                const frontendResponse = await fetch('/');
                const frontendTime = performance.now() - frontendStart;
                
                // Test backend server
                const backendStart = performance.now();
                const backendResponse = await fetch('http://localhost:5000/api/bmi', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ height: 175, weight: 80 })
                });
                const backendTime = performance.now() - backendStart;
                
                serverStatus.innerHTML = `
                    <div class="success">
                        ‚úÖ <strong>Frontend:</strong> ${frontendResponse.status} (${frontendTime.toFixed(2)}ms)<br>
                        ‚úÖ <strong>Backend:</strong> ${backendResponse.status} (${backendTime.toFixed(2)}ms)
                    </div>
                `;
            } catch (error) {
                serverStatus.innerHTML = `
                    <div class="error">
                        ‚ùå <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        async function debugAPI() {
            const apiStatus = document.getElementById('api-status');
            const results = [];
            
            const endpoints = [
                { name: 'BMI Calculation', url: 'http://localhost:5000/api/bmi', method: 'POST', body: { height: 175, weight: 80 } },
                { name: 'Login (Expected 401)', url: 'http://localhost:5000/api/login', method: 'POST', body: { email: 'test@example.com', password: 'wrong' } }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const start = performance.now();
                    const response = await fetch(endpoint.url, {
                        method: endpoint.method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(endpoint.body)
                    });
                    const time = performance.now() - start;
                    const data = await response.json();
                    
                    results.push(`‚úÖ <strong>${endpoint.name}:</strong> ${response.status} (${time.toFixed(2)}ms)`);
                } catch (error) {
                    results.push(`‚ùå <strong>${endpoint.name}:</strong> ${error.message}`);
                }
            }
            
            apiStatus.innerHTML = `<div class="success">${results.join('<br>')}</div>`;
        }
        
        async function debugJavaScript() {
            const jsStatus = document.getElementById('js-status');
            const results = [];
            
            const jsFiles = [
                '/src/utils/api.js',
                '/src/utils/auth.js',
                '/src/app.js'
            ];
            
            for (const file of jsFiles) {
                try {
                    const start = performance.now();
                    const response = await fetch(file);
                    const time = performance.now() - start;
                    
                    if (response.ok) {
                        results.push(`‚úÖ <strong>${file}:</strong> ${response.status} (${time.toFixed(2)}ms)`);
                    } else {
                        results.push(`‚ùå <strong>${file}:</strong> ${response.status}`);
                    }
                } catch (error) {
                    results.push(`‚ùå <strong>${file}:</strong> ${error.message}`);
                }
            }
            
            jsStatus.innerHTML = `<div class="success">${results.join('<br>')}</div>`;
        }
        
        async function debugPerformance() {
            const perfStatus = document.getElementById('performance-status');
            
            const timing = performance.timing;
            const loadTime = timing.loadEventEnd - timing.navigationStart;
            const domReady = timing.domContentLoaded - timing.navigationStart;
            
            perfStatus.innerHTML = `
                <div class="success">
                    üìä <strong>Page Load:</strong> ${loadTime}ms<br>
                    üèóÔ∏è <strong>DOM Ready:</strong> ${domReady}ms<br>
                    üß† <strong>Memory:</strong> ${(performance.memory?.usedJSHeapSize / 1024 / 1024).toFixed(2) || 'N/A'}MB
                </div>
            `;
        }
        
        // Run all tests
        async function runAllTests() {
            console.log('üîç Starting diagnostic tests...');
            
            await Promise.all([
                debugServers(),
                debugAPI(),
                debugJavaScript(),
                debugPerformance()
            ]);
            
            console.log('‚úÖ All diagnostic tests completed');
        }
        
        // Start tests when page loads
        document.addEventListener('DOMContentLoaded', runAllTests);
        
        // Also test the API client if it's available
        setTimeout(() => {
            if (window.apiClient) {
                console.log('‚úÖ API Client loaded successfully');
                console.log('üîß API Base URL:', window.apiClient.baseURL);
            } else {
                console.log('‚ùå API Client not found');
            }
        }, 1000);
    </script>
</body>
</html>